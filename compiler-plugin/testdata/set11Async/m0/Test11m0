package cpstest

import cps._
import scala.concurrent._
import scala.concurrent.duration._
import scala.concurrent.ExecutionContext.Implicits.global

import java.util.concurrent.ScheduledExecutorService


object Test11m1 {


  def fetch(url:String)(using CpsDirect[Future]): String = {
    Future successful s"result of $url"
  }

  def fetchAll(urls:List[String])(using CpsDirect[Future]): List[String] = {
    urls.zip(delays).delay.map(async((url,delay) => fetch(url,delay))).map(await(_))
  }

  def main(args:Array[String]): Unit = {
     val r = fetchAll(List("url1", "url2", "url3"))
     if (r.contains("result of url1") && r.contains("result of url2") && r.contains("result of url3")) then
       println("OK")
     else
       println(r)
  }

}

